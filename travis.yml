dist: trusty

sudo: required

language: cpp

services:
  - docker

env:
  global:
    - GITHUB_REPO=pmem/pmemkv
    - DOCKERHUB_REPO=ldorau/pmemkv
    - OS=centos
    - OS_VER=8
    - BUILD_JSON_CONFIG=OFF # no RapidJSON package
    - CHECK_CPP_STYLE=OFF   # clang-format too old (7.0)
    - TEST_PACKAGES=OFF     # memkind too old
  matrix:
    - TYPE=normal
    - TYPE=building

before_install:
  - echo $TRAVIS_COMMIT_RANGE
  - export HOST_WORKDIR=`pwd`
  - cd utils/docker
  - ./pull-or-rebuild-image.sh

script:
  - ./build.sh

after_success:
  - source ./set-vars.sh
  - if [[ -f $CI_FILE_PUSH_IMAGE_TO_REPO ]]; then images/push-image.sh $OS-$OS_VER; fi
